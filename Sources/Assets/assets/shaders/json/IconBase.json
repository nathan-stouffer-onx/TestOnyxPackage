{
    "TODO": "Only supports two colors for now",

    "sortOrder" : 1,
    "requirements":
    {
        "position": true,
        "positionOutput": true
    },
    "bools": {
        "CanonTileCoords": true,
        "PositionOutput" : true,
        "TransformPosition" : true
    },
    "ints": {
        "ColorCount" : 0,
        "UVCount" :  1
    },
    "inputs" :
    [
        {
            "alias": "position",
            "dataType": "vec3"
        },
        {
            "alias": "texcoord0",
            "dataType": "vec4"
        }
    ],

    "outputs" :
    [
        {
            "alias": "position",
            "dataType": "vec3",
            "conditional" : {
                "ifBoolTrue": "PositionOutput"
            }
        },
        {
            "alias": "texcoord0",
            "dataType": "vec4"
        },
        {
            "alias": "color0",
            "dataType": "vec4"
        },
        {
            "alias": "color1",
            "dataType": "vec4"
        }
    ],

    "chunks": [
    {
        "comment" : "#include \"map3dFunctions.sc\"",
        "position": "Includes",
        "type": "Vertex_and_Pixel",
        "lines":
        [
            "#include <../examples/common/common.sh>",
            "#include \"map3dFunctions.sc\""
        ]
    },
    {
        "comment": "Aliases our shader system doesn't make automatically",
        "type": "Vertex",
        "position": "Main",
        "lines":
        [
            "\t// Custom aliases",
            "\tvec3 midpoint = iconPos.xyz;",
            "\tfloat uniformScale = u_scale.x;",
            "\tvec2 scale = uniformScale * pixelSize.xy;",
            "\tvec2 tilePos = midpoint.xy;",
            "\tfloat tileZ = 0.f; // Height value"
        ]
    },
    { 
        "type": "Vertex",
        "position": "Main",
        "positionOffset": 3,
        "lines":[
            "\t// Midpoint is in canonical tile coordinates, including height",
            "\tmidpoint.z = tileZ;",
            "\tmidpoint.z = (midpoint.z - cHeightRange[0]) / (cHeightRange[1] - cHeightRange[0]);",
            "\tmidpoint = mix(u_tileMin.xyz, u_tileMax.xyz, midpoint.xyz);"
        ],
        "conditional" : {
            "ifBoolTrue": "CanonTileCoords"
        }
    },
    {
        "type": "Vertex",
        "position": "Main",
        "positionOffset": 5,
        "comment": "Scale then rotate then translate. We assume quaternions are {x, y, z, w}",
        "lines":
        [
            "\t// Scale, rotate, translate position",
            "\tposition = vec3(scale.xy, 1.0) * position;",
            "\tposition = rotate(quatRot, position) + midpoint + color0.xyz + color1.xyz;"
        ],
        "conditional":{
            "ifBoolTrue": "TransformPosition"
        }
    },
    {
        "type": "Vertex",
        "position": "Compose",
        "lines": [
            "\tgl_Position = mul(u_proj, mul(u_view, vec4(position.xyz, 1.0)));"
        ],
        "conditional" : {
            "ifBoolTrue": "PositionOutput"
        }
    },
    {
        "Comment": "This is for compatibility with the TextureLayer component",
        "type": "Pixel",
        "position": "Main",
        "data": "\tvec2 texcoords = texcoord0.xy;"
    },
    {
        "type": "Pixel",
        "position": "Main",
        "data": "\tvec4 fragColor = vec4_splat(0.f);"
    },
    {

        "type": "Pixel",
        "position": "Compose",
        "positionOffset": 10,
        "data": "\tgl_FragColor = fragColor;"
    }
],

    "shaderParameters": [
        {
            "componentName": "IconBase",
            "name": "u_tileMin",
            "realtimeUniform": true,
            "type": "vec3",
            "vec3": {
                "x": 0.0,
                "y": 0.0,
                "z": 0.0
            },
            "conditional": {
                "ifBoolTrue": "CanonTileCoords"
            }
        },
        {
            "componentName": "IconBase",
            "name": "u_tileMax",
            "realtimeUniform": true,
            "type": "vec3",
            "vec3": {
                "x": 1.0,
                "y": 1.0,
                "z": 1.0
            },
            "conditional": {
                "ifBoolTrue": "CanonTileCoords"
            }
        },
        {
            "componentName": "IconBase",
            "imguiRate": 0.01,
            "min": -99999.0,
            "max": 99999.0,
            "name": "u_scale",
            "realtimeUniform": true,
            "type": "vec3",
            "vec3": {
                "x": 1.0,
                "y": 1.0,
                "z": 1.0
            }
        },



        {
            "componentName": "IconBase",
            "imguiRate": 0.01,
            "min": 1.0,
            "max": -1.0,
            "name": "color1",
            "realtimeUniform": false,
            "instanced": true,
            "type": "vec4",
            "vec3": {
                "x": 0.0,
                "y": 0.0,
                "z": 0.0,
                "w": 1.0
            }
        },
        {
            "componentName": "IconBase",
            "imguiRate": 0.01,
            "min": 1.0,
            "max": -1.0,
            "name": "color0",
            "realtimeUniform": false,
            "instanced": true,
            "type": "vec4",
            "vec3": {
                "x": 0.0,
                "y": 0.0,
                "z": 0.0,
                "w": 1.0
            }
        },
        {
            "componentName": "IconBase",
            "name": "quatRot",
            "realtimeUniform": false,
            "instanced": true,
            "type": "vec4",
            "vec3": {
                "x": 0.0,
                "y": 0.0,
                "z": 0.0,
                "w": 1.0
            }
        },
        {
            "componentName": "IconBase",
            "imguiRate": 0.01,
            "min": -1.0,
            "max": 1.0,
            "name": "pixelSize",
            "realtimeUniform": false,
            "instanced": true,
            "type": "vec4",
            "vec3": {
                "x": 1.0,
                "y": 1.0,
                "z": 0.0,
                "w": 0.0
            }
        },
        {
            "comment": "xy - icon position relative in canonical tile coordinates. z is height and is calculated in shader",
            "componentName": "IconBase",
            "name": "iconPos",
            "realtimeUniform": false,
            "instanced": true,
            "type": "vec3",
            "vec3": {
                "x": 0.0,
                "y": 0.0,
                "z": 0.0,
                "w": 1.0
            }
        }
    ]
}
